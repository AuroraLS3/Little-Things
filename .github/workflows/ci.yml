name: CI

on: [push, pull_request]
jobs:
  test:
    name: Build & upload dev builds

    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout git repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: â˜• Setup JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'adopt'
          java-version: '8'
      - name: ðŸ›  Build Little Chef
        run: |
          cd littlechef
          mvn package
      - name: ðŸ›  Build Little Composter
        run: |
          cd littlecomposter
          mvn package
      - name: ðŸ›  Build Little Effects
        run: |
          cd littlefx
          mvn package
      - name: ðŸ›  Build Mob Banners
        run: |
          cd littlemobbanners
          mvn package
      - name: ðŸ›  Build Little XP
        run: |
          cd littlexp
          mvn package
      - name: âš™ Generate upload metadata
        run: |
          git_hash=$(git rev-parse --short "$GITHUB_SHA")
          echo "git_hash=$git_hash" >> $GITHUB_ENV
          echo "littlechefBuild=$(find littlechef/target -iname *.jar)" >> $GITHUB_ENV
          echo "littlecomposterBuild=$(find littlecomposter/target -iname *.jar)" >> $GITHUB_ENV
          echo "littlefxBuild=$(find littlefx/target -iname *.jar)" >> $GITHUB_ENV
          echo "littlemobbannersBuild=$(find littlemobbanners/target -iname *.jar)" >> $GITHUB_ENV
          echo "littlexpBuild=$(find littlexp/target -iname *.jar)" >> $GITHUB_ENV
      - name: ðŸ“¤ Upload Little Chef
        uses: actions/upload-artifact@v3
        with:
          name: LittleChef-${{ env.git_hash }}.zip
          path: ${{ env.littlechefBuild }}
      - name: ðŸ“¤ Upload Little Composter
        uses: actions/upload-artifact@v3
        with:
          name: LittleComposter-${{ env.git_hash }}.zip
          path: ${{ env.littlecomposterBuild }}
      - name: ðŸ“¤ Upload Little Effects
        uses: actions/upload-artifact@v3
        with:
          name: LittleFX-${{ env.git_hash }}.zip
          path: ${{ env.littlefxBuild }}
      - name: ðŸ“¤ Upload Mob Banners
        uses: actions/upload-artifact@v3
        with:
          name: MobBanners-${{ env.git_hash }}.zip
          path: ${{ env.littlemobbannersBuild }}
      - name: ðŸ“¤ Upload Little XP
        uses: actions/upload-artifact@v3
        with:
          name: LittleXP-${{ env.git_hash }}.zip
          path: ${{ env.littlexpBuild }}
